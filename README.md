# StockProphet

StockProphet 是個台股分析的程式，此程式會需要用到關聯資料庫來存放股市資料與分析。  
以下為此程式的幾個特點：

1. 支援資料庫為 SQLite、MySQL、MSSQL、PostgreSQL
2. 擷取股市的每日歷史資料表、月營收資料表、資產負債表、綜合損益表
3. 自我檢查資料狀態，當程式中斷後再執行會接續之後的資料
4. 根據每日歷史資料來計算每週歷史資料表跟每月歷史資料表
5. 提供技術面與基本面的指令來分析有價值的股票


## 安裝方式

### 方式一：使用 docker 安裝

```bash
make docker-image
docker run -e "TZ=Asia/Taipei" stockprophet [command]
```

### 方式二：使用 setup.py 安裝

```bash
python setup.py install
stockprophet [command]
```

## 使用說明

### **首先建立資料表：**

#### 1. 建立每日歷史資料表 (預計所需時間 2~4 hrs)
> 由於擷取資料來源為 [台灣證交所](https://www.twse.com.tw/) 與 [證券櫃檯買賣中心](https://www.tpex.org.tw/) ，該網站皆有防 **DDoS** 攻擊， 因此擷取一筆資料都需睡眠一段時間，  
> 但是既使如此仍可能出現擷取失敗的狀況，所以可能會需要重新執行幾次來確保資料完整。

```bash
# 同時收集上市跟上櫃歷史的每日資料表
stockprophet stock build daily-history-table
# 只收集上市的每日歷史資料表(選填)
stockprophet stock build daily-history-table -t tse
# 只收集上櫃的每日歷史資料表(選填)
stockprophet stock build daily-history-table -t otc
```

#### 2. 建立每週與每月歷史資料表 (預計所需時間 4~12 hrs)
> 此步驟需確保每日歷史資料表完整後才可以執行，否則會計算誤差而影響到技術面的分析。

```bash
stockprophet stock build period-history-table
```

#### 3. 建立每月營收表 (預計所需時間 2~4 hrs)

```bash
stockprophet stock build mops-monthly-revenue-table
```

#### 4. 建立每季資產負債表 (預計所需時間 4~5 days)
> 可能出現擷取失敗的狀況，所以可能會需要重新執行幾次來確保資料完整。

```bash
stockprophet stock build mops-balance-sheet-table
```

#### 5. 建立每季綜合損益表 (預計所需時間 4~5 days)
> 可能出現擷取失敗的狀況，所以可能會需要重新執行幾次來確保資料完整。

```bash
stockprophet stock build mops-income-statement-table
```

### **執行股市分析：**

#### 技術面： MACD

```bash
# 依據每日歷史資料表找出 MACD 黃金交叉的股票
stockprophet ta get macd  # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價    　　   漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　        駿吉-KY(1591)                16.2           0.05%              27            1.53            0.17                4.3%                  13.44%
　　           台名(5878)                46.8            0.8%               1            2.34            0.96              12.61%                  22.46%

# 依據每週歷史資料表找出 MACD 黃金交叉的股票
stockprophet ta get macd --use_weekly  # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價      　　 漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　           至興(4535)                25.8           1.15%              93            0.92            0.14               4.73%                   9.16%
　　           瓦城(2729)               229.5            2.5%              95            2.73            2.18               8.09%                  52.34%

# 依據每月歷史資料表找出 MACD 黃金交叉的股票
stockprophet ta get macd --use_monthly # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價    　　   漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　           精確(3162)                19.0           3.95%             649            5.86           -0.17             -11.21%                   4.06%
　　           台興(3426)                40.4           3.45%             211            1.79            0.55               11.7%                  33.85%

```

#### 技術面： KDJ

```bash
# 依據每日歷史資料表找出 KD 線皆低於30且 K 線與 D 線黃金交叉的股票
stockprophet ta get kdj  # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價    　　   漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　　        大展證(6020)                13.5            0.0%             102            0.87             0.6                                            
　　　     捷必勝-KY(8418)               13.15            0.1%               1            0.94           -0.51             -19.26%                  -3.08%
```


#### 基本面： 股價淨值比

```bash
# 找出股價淨值比介於 0.5 到 1.0 之間的股票
stockprophet ba get pbr # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價    　　   漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　        其祥-KY(1258)                13.0           0.05%               3            0.91            0.91               5.24%                  19.25%
　　           冠好(8354)                16.9            0.1%               7            0.78            0.03               9.67%                  23.05%
```

#### 基本面： 每股盈餘

```bash
# 找出每股盈餘介於 3.0 到 10.0 之間的股票
stockprophet ba get eps # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價    　　   漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　           德麥(1264)               219.5            0.0%              12            3.36            3.56              16.74%                  34.56%
　　           興采(4433)                46.7           0.05%             181             1.7            6.91               7.23%                  24.76%
```

#### 基本面： 資產負債分析

```bash
# 找出連續3季資產增加且連續3季負債減少的股票
stockprophet ba get balance # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價    　　   漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　           德記(5902)                17.0           0.25%             229            1.88            0.35              10.87%                  25.57%
　　　　    倚強股份(3219)                41.6            0.6%              39            3.84            0.85              82.35%                   95.4%
```

#### 基本面： 營益率

```bash
# 找出營益率介於 10.0 到 100.0 之間的股票
stockprophet ba get opm # 2020-10-10 輸出片段結果
========================        ============    ============    ============    ============    ============    ================        ================
　　　　        名稱(代號)        　　     股價    　　   漲幅(%)    　　　 成交量    　　　  淨值比             EPS    　　　   營益率(%)        　　　   毛利率(%)
========================        ============    ============    ============    ============    ============    ================        ================
　　           德麥(1264)               219.5            0.0%              12            3.36            3.56              16.74%                  34.56%
　　　　      中華食(4205)                89.2            0.0%              29            4.97            0.98              25.23%                  42.21%
```
